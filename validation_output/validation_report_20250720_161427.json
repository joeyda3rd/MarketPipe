{
  "start_time": "2025-07-20T16:14:02.923970",
  "end_time": "2025-07-20T16:14:27.807220",
  "mode": "critical",
  "test_environment": {
    "test_config_file": "test_data/test_config.yaml",
    "minimal_config_file": "test_data/minimal_config.yaml",
    "data_dir": "test_data",
    "output_dir": "validation_output",
    "timeout": 120,
    "mode": "critical"
  },
  "summary": {
    "overall_status": "PASS",
    "pass_rate": "100.0%",
    "duration_seconds": 24.88,
    "category_breakdown": {
      "health_check": {
        "total": 2,
        "pass": 2,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "providers": {
        "total": 1,
        "pass": 1,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "basic_commands": {
        "total": 3,
        "pass": 3,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "configuration": {
        "total": 2,
        "pass": 2,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "parameter_validation": {
        "total": 3,
        "pass": 3,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "symbols": {
        "total": 1,
        "pass": 1,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "data_management": {
        "total": 3,
        "pass": 3,
        "fail": 0,
        "error": 0,
        "skip": 0
      }
    },
    "severity_breakdown": {
      "critical": {
        "total": 1,
        "pass": 1,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "normal": {
        "total": 7,
        "pass": 7,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "high": {
        "total": 4,
        "pass": 4,
        "fail": 0,
        "error": 0,
        "skip": 0
      },
      "low": {
        "total": 3,
        "pass": 3,
        "fail": 0,
        "error": 0,
        "skip": 0
      }
    },
    "slowest_tests": [
      {
        "name": "Basic Health Check",
        "duration": 6.69,
        "status": "PASS"
      },
      {
        "name": "Health Check Verbose",
        "duration": 4.31,
        "status": "PASS"
      },
      {
        "name": "Invalid Symbol Format",
        "duration": 1.82,
        "status": "PASS"
      },
      {
        "name": "OHLCV Command Structure",
        "duration": 1.28,
        "status": "PASS"
      },
      {
        "name": "Missing Required Parameters",
        "duration": 1.23,
        "status": "PASS"
      }
    ],
    "critical_failures": []
  },
  "results": [
    {
      "test_name": "Basic Health Check",
      "category": "health_check",
      "command": "python -m marketpipe health-check",
      "status": "PASS",
      "duration": 6.69086480140686,
      "exit_code": 1,
      "stdout": "Running MarketPipe health check...\n\nMarketPipe Health Check Report\n==================================================\n\nSummary: 9/10 checks passed\nWarnings: 1\nFailures: 1\n\n\u2705 Python version compatibility\n   Time: 0.0ms\n\n\u2705 Required dependencies\n   Time: 7.8ms\n\n\u2705 MarketPipe installation\n   Time: 0.0ms\n\n\u2705 Configuration file validity\n   Time: 0.0ms\n\n\u2705 Provider registry\n   Time: 0.0ms\n\n\u2705 Fake provider functionality\n   Time: 1087.0ms\n\n\u2705 Database connectivity\n   Time: 54.0ms\n\n\u2705 Data directory permissions\n   Time: 0.5ms\n\n\u2705 CLI commands accessibility\n   Time: 1099.3ms\n\n\u274c End-to-end pipeline test\n   Error: Pipeline test failed: /usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n\n   Time: 1406.9ms\n\nRecommendations:\n---------------\n\u2022 end_to_end_pipeline: Run individual components to isolate the issue\n\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n\nHealth check completed with 1 failures.\n",
      "error_message": "",
      "expected_behavior": "should complete health diagnostics",
      "actual_behavior": "Command failed: __import__(pkg_name)",
      "severity": "critical"
    },
    {
      "test_name": "Health Check Verbose",
      "category": "health_check",
      "command": "python -m marketpipe health-check --verbose",
      "status": "PASS",
      "duration": 4.309406280517578,
      "exit_code": 1,
      "stdout": "Running MarketPipe health check...\n\nMarketPipe Health Check Report\n==================================================\n\nSummary: 9/10 checks passed\nWarnings: 1\nFailures: 1\n\n\u2705 Python version compatibility\n   Details: {'version': '3.10.12', 'compatible': True}\n   Time: 0.0ms\n\n\u2705 Required dependencies\n   Details: {'installed_packages': {'typer': '0.16.0', 'pydantic': '2.9.2', 'httpx': '0.28.1', 'pandas': '2.3.0', 'pyarrow': '20.0.0', 'duckdb': '1.3.1', 'pyyaml': '6.0.2', 'python-dotenv': 'unknown', 'prometheus-client': 'unknown'}, 'all_required_present': True}\n   Time: 3.5ms\n\n\u2705 MarketPipe installation\n   Details: {'version': '0.1.0-alpha.1', 'importable': True}\n   Time: 0.0ms\n\n\u2705 Configuration file validity\n   Details: {'config_file': None, 'using_defaults': True}\n   Time: 0.0ms\n\n\u2705 Provider registry\n   Details: {'available_providers': ['alpaca', 'fake', 'finnhub', 'iex', 'polygon'], 'provider_count': 5}\n   Time: 0.0ms\n\n\u2705 Fake provider functionality\n   Details: {'fake_provider_available': True, 'cli_accessible': True}\n   Time: 937.3ms\n\n\u2705 Database connectivity\n   Details: {'duckdb_working': True, 'test_database_path': '/tmp/tmp9t9jp3xs/test.db'}\n   Time: 43.9ms\n\n\u2705 Data directory permissions\n   Details: {'current_directory': '/home/joey/MarketPipe', 'writable': True}\n   Time: 0.2ms\n\n\u2705 CLI commands accessibility\n   Details: {'cli_accessible': True, 'help_working': True}\n   Time: 1044.4ms\n\n\u274c End-to-end pipeline test\n   Error: Pipeline test failed: /usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n\n   Time: 1292.0ms\n\nRecommendations:\n---------------\n\u2022 end_to_end_pipeline: Run individual components to isolate the issue\n\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n\nHealth check completed with 1 failures.\n",
      "error_message": "",
      "expected_behavior": "should show detailed health check output",
      "actual_behavior": "Command failed: __import__(pkg_name)",
      "severity": "normal"
    },
    {
      "test_name": "List Providers",
      "category": "providers",
      "command": "python -m marketpipe providers",
      "status": "PASS",
      "duration": 0.9922099113464355,
      "exit_code": 0,
      "stdout": "\ud83d\udcca Available market data providers:\n  \u2022 alpaca\n  \u2022 fake\n  \u2022 finnhub\n  \u2022 iex\n  \u2022 polygon\n\nTotal: 5 providers\n\n\ud83d\udca1 Usage: marketpipe ingest-ohlcv --provider <name> ...\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n",
      "error_message": "",
      "expected_behavior": "should list available data providers",
      "actual_behavior": "Command completed successfully",
      "severity": "high"
    },
    {
      "test_name": "Main Help",
      "category": "basic_commands",
      "command": "python -m marketpipe --help",
      "status": "PASS",
      "duration": 0.9857058525085449,
      "exit_code": 0,
      "stdout": "                                                                                                            \n Usage: python -m marketpipe [OPTIONS] COMMAND [ARGS]...                                                    \n                                                                                                            \n MarketPipe ETL commands for financial data processing                                                      \n                                                                                                            \n \u26a0\ufe0f  ALPHA SOFTWARE: Expect breaking changes and stability issues. Not recommended for production use.       \n                                                                                                            \n\u256d\u2500 Options \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 --help          Show this message and exit.                                                              \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\u256d\u2500 Commands \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 ingest-ohlcv      Ingest OHLCV data from market data providers.                                          \u2502\n\u2502 validate-ohlcv    Validate OHLCV data quality and generate reports (convenience command).                \u2502\n\u2502 aggregate-ohlcv   Aggregate OHLCV data to multiple timeframes (convenience command).                     \u2502\n\u2502 ingest            [DEPRECATED] Use 'ingest-ohlcv' or 'ohlcv ingest' instead.                             \u2502\n\u2502 validate          [DEPRECATED] Use 'validate-ohlcv' or 'ohlcv validate' instead.                         \u2502\n\u2502 aggregate         [DEPRECATED] Use 'aggregate-ohlcv' or 'ohlcv aggregate' instead.                       \u2502\n\u2502 query             Run an ad-hoc query on aggregated data.                                                \u2502\n\u2502 metrics           Manage and view MarketPipe metrics.                                                    \u2502\n\u2502 providers         List available market data providers.                                                  \u2502\n\u2502 migrate           Apply any pending SQLite migrations.                                                   \u2502\n\u2502 health-check      Run comprehensive health check of MarketPipe installation and configuration.           \u2502\n\u2502 factory-reset     \ud83d\udea8 NUCLEAR OPTION: Factory reset to wipe ALL data, history, and metrics.               \u2502\n\u2502 ohlcv             OHLCV pipeline commands                                                                \u2502\n\u2502 prune             Data retention utilities                                                               \u2502\n\u2502 symbols           Symbol-master related commands.                                                        \u2502\n\u2502 jobs              Ingestion job management commands                                                      \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n",
      "error_message": "",
      "expected_behavior": "should show main help menu",
      "actual_behavior": "Command completed successfully",
      "severity": "low"
    },
    {
      "test_name": "Jobs List (Empty)",
      "category": "basic_commands",
      "command": "python -m marketpipe jobs list",
      "status": "PASS",
      "duration": 1.0152218341827393,
      "exit_code": 0,
      "stdout": "\ud83d\udced No jobs found matching the criteria\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n",
      "error_message": "",
      "expected_behavior": "should list jobs (may be empty)",
      "actual_behavior": "Command completed successfully",
      "severity": "normal"
    },
    {
      "test_name": "Jobs Status",
      "category": "basic_commands",
      "command": "python -m marketpipe jobs status",
      "status": "PASS",
      "duration": 1.149418830871582,
      "exit_code": 0,
      "stdout": "\ud83d\udcca Job Status Summary\n==============================\n------------------------------\nTOTAL       :      0\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n",
      "error_message": "",
      "expected_behavior": "should show jobs status summary",
      "actual_behavior": "Command completed successfully",
      "severity": "normal"
    },
    {
      "test_name": "Config File Access - Valid Config",
      "category": "configuration",
      "command": "python -c \"import yaml; config=yaml.safe_load(open('test_data/test_config.yaml')); print('Config loaded successfully' if config else 'Failed')\"",
      "status": "PASS",
      "duration": 0.03328061103820801,
      "exit_code": 0,
      "stdout": "Config loaded successfully\n",
      "stderr": "",
      "error_message": "",
      "expected_behavior": "should load and parse valid configuration file",
      "actual_behavior": "Command completed successfully",
      "severity": "high"
    },
    {
      "test_name": "Parameter Validation - Invalid Date Range",
      "category": "configuration",
      "command": "python -m marketpipe ingest-ohlcv --symbols AAPL --start 2025-12-31 --end 2025-01-01 --output /tmp/test_output",
      "status": "PASS",
      "duration": 1.112642526626587,
      "exit_code": 2,
      "stdout": "",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n\u274c end date must not be before start date\n",
      "error_message": "",
      "expected_behavior": "should reject invalid date range (end before start)",
      "actual_behavior": "Command failed: __import__(pkg_name)",
      "severity": "high"
    },
    {
      "test_name": "Invalid Symbol Format",
      "category": "parameter_validation",
      "command": "python -m marketpipe ingest-ohlcv --symbols '123INVALID' --start 2025-07-19 --end 2025-07-20 --output /tmp/test_output",
      "status": "PASS",
      "duration": 1.8231143951416016,
      "exit_code": 1,
      "stdout": "\u26a0\ufe0f  ALPHA SOFTWARE WARNING: MarketPipe is in alpha development.\n   Expect breaking changes and potential stability issues.\n   Not recommended for production use without thorough testing.\n\n\ud83d\udcca Ingestion Configuration:\n  Symbols: 123INVALID\n  Date range: 2025-07-19 to 2025-07-20\n  Provider: alpaca\n  Feed type: iex\n  Output path: /tmp/test_output\n  Workers: 3\n  Batch size: 500\n\n\ud83d\ude80 Starting ingestion process...\n\ud83d\udcdd Creating ingestion job...\n\u2705 Created job: 123INVALID_2025-07-19\n\u26a1 Starting job execution...\n\u2705 Job completed successfully!\n\ud83d\udcca Job ID: 123INVALID_2025-07-19\n\ud83d\udcca Symbols processed: 1\n\ud83d\udcca Total bars: 0\n\u23f1\ufe0f  Processing time: 0.52s\n\n\ud83d\udd0d Running post-ingestion verification...\n\u274c Post-ingestion verification failed for 123INVALID\n\u274c Ingestion failed: 1\n\ud83e\uddf9 Background cleanup completed\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\nERROR: No data found for symbol 123INVALID\n",
      "error_message": "",
      "expected_behavior": "should reject invalid symbol format",
      "actual_behavior": "Command failed: __import__(pkg_name)",
      "severity": "normal"
    },
    {
      "test_name": "Missing Required Parameters",
      "category": "parameter_validation",
      "command": "python -m marketpipe ingest-ohlcv --output /tmp/test_output",
      "status": "PASS",
      "duration": 1.228771686553955,
      "exit_code": 1,
      "stdout": "\u26a0\ufe0f  ALPHA SOFTWARE WARNING: MarketPipe is in alpha development.\n   Expect breaking changes and potential stability issues.\n   Not recommended for production use without thorough testing.\n\n\u274c Error: Either provide --config file OR all of --symbols, --start, and --end\n\u274c Ingestion failed: 1\n\ud83e\uddf9 Background cleanup completed\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n",
      "error_message": "",
      "expected_behavior": "should require symbols and date range",
      "actual_behavior": "Command failed: __import__(pkg_name)",
      "severity": "high"
    },
    {
      "test_name": "OHLCV Command Structure",
      "category": "parameter_validation",
      "command": "python -m marketpipe ohlcv ingest --symbols AAPL --start 2025-07-19 --end 2025-07-20 --output /tmp/test_nonexistent_provider",
      "status": "PASS",
      "duration": 1.281649112701416,
      "exit_code": 1,
      "stdout": "\u26a0\ufe0f  ALPHA SOFTWARE WARNING: MarketPipe is in alpha development.\n   Expect breaking changes and potential stability issues.\n   Not recommended for production use without thorough testing.\n\n\ud83d\udcca Ingestion Configuration:\n  Symbols: AAPL\n  Date range: 2025-07-19 to 2025-07-20\n  Provider: alpaca\n  Feed type: iex\n  Output path: /tmp/test_nonexistent_provider\n  Workers: 3\n  Batch size: 500\n\n\ud83d\ude80 Starting ingestion process...\n\ud83d\udcdd Creating ingestion job...\n\u274c Ingestion failed: Job scheduling conflicts: Symbols ['AAPL'] are already being processed by job AAPL_2024-01-01\n\ud83e\uddf9 Background cleanup completed\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\nINFO  [alembic.runtime.migration] Context impl SQLiteImpl.\nINFO  [alembic.runtime.migration] Will assume non-transactional DDL.\n",
      "error_message": "",
      "expected_behavior": "should handle command structure validation",
      "actual_behavior": "Command failed: __import__(pkg_name)",
      "severity": "normal"
    },
    {
      "test_name": "Symbol Update - Dry Run",
      "category": "symbols",
      "command": "python -m marketpipe symbols update --dry-run",
      "status": "PASS",
      "duration": 1.0983316898345947,
      "exit_code": 0,
      "stdout": "Symbol update plan:\n  providers: dummy, nasdaq_dl, polygon\n  snapshot_as_of: 2025-07-20\n  db: data/db/warehouse.duckdb\n  data_dir: data\n  dry_run: True\n  diff_only: False\n  execute: False\nDry preview complete. Re-run with --execute to perform writes.\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n",
      "error_message": "",
      "expected_behavior": "should perform symbol update dry run",
      "actual_behavior": "Command completed successfully",
      "severity": "normal"
    },
    {
      "test_name": "Query Help",
      "category": "data_management",
      "command": "python -m marketpipe query --help",
      "status": "PASS",
      "duration": 1.0727818012237549,
      "exit_code": 0,
      "stdout": "                                                                                                            \n Usage: python -m marketpipe query [OPTIONS] SQL                                                            \n                                                                                                            \n Run an ad-hoc query on aggregated data.                                                                    \n                                                                                                            \n Available views: bars_5m, bars_15m, bars_1h, bars_1d                                                       \n Examples:     marketpipe query \"SELECT * FROM bars_5m WHERE symbol='AAPL' LIMIT 10\"     marketpipe query   \n \"SELECT symbol, COUNT(*) FROM bars_1d GROUP BY symbol\" --csv     marketpipe query \"SELECT MAX(high),       \n MIN(low) FROM bars_1h WHERE symbol='MSFT'\"                                                                 \n                                                                                                            \n\u256d\u2500 Arguments \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 *    sql      TEXT  DuckDB SQL using views bars_5m|15m|1h|1d [default: None] [required]                  \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\u256d\u2500 Options \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 --csv                     Output CSV to stdout                                                           \u2502\n\u2502 --limit  -l      INTEGER  Limit number of rows in table output [default: 50]                             \u2502\n\u2502 --help                    Show this message and exit.                                                    \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n",
      "error_message": "",
      "expected_behavior": "should show query command help",
      "actual_behavior": "Command completed successfully",
      "severity": "normal"
    },
    {
      "test_name": "Prune Parquet Help",
      "category": "data_management",
      "command": "python -m marketpipe prune parquet --help",
      "status": "PASS",
      "duration": 1.0532727241516113,
      "exit_code": 0,
      "stdout": "                                                                                                            \n Usage: python -m marketpipe prune parquet [OPTIONS] OLDER_THAN                                             \n                                                                                                            \n Delete parquet files older than the specified cutoff.                                                      \n                                                                                                            \n Searches for parquet files in the directory structure and deletes entire partition files whose date folder \n is older than the cutoff.                                                                                  \n Examples:     marketpipe prune parquet 5y                    # Delete files older than 5 years             \n marketpipe prune parquet 30d --dry-run         # Preview 30-day cleanup     marketpipe prune parquet 18m   \n --root ./data     # Custom root directory                                                                  \n                                                                                                            \n\u256d\u2500 Arguments \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 *    older_than      TEXT  Age threshold (e.g., 5y, 30d, 18m) [default: None] [required]                 \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\u256d\u2500 Options \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 --root             PATH  Root directory containing parquet files [default: data/parquet]                 \u2502\n\u2502 --dry-run  -n            Show what would be deleted without making changes                               \u2502\n\u2502 --help                   Show this message and exit.                                                     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n",
      "error_message": "",
      "expected_behavior": "should show prune parquet options",
      "actual_behavior": "Command completed successfully",
      "severity": "low"
    },
    {
      "test_name": "Prune Database Help",
      "category": "data_management",
      "command": "python -m marketpipe prune database --help",
      "status": "PASS",
      "duration": 0.9538400173187256,
      "exit_code": 0,
      "stdout": "                                                                                                            \n Usage: python -m marketpipe prune database [OPTIONS] OLDER_THAN                                            \n                                                                                                            \n Delete old rows from the ingestion_jobs database (SQLite or PostgreSQL).                                   \n                                                                                                            \n Removes job records whose trading day is older than the cutoff date and runs VACUUM to reclaim space.      \n Works with both SQLite and PostgreSQL backends.                                                            \n Examples:     marketpipe prune database 18m          # Delete jobs older than 18 months     marketpipe     \n prune database 90d --dry-run # Preview 90-day cleanup                                                      \n                                                                                                            \n\u256d\u2500 Arguments \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 *    older_than      TEXT  Age threshold (e.g., 18m, 90d) [default: None] [required]                     \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\u256d\u2500 Options \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n\u2502 --dry-run  -n        Show what would be deleted without making changes                                   \u2502\n\u2502 --help               Show this message and exit.                                                         \u2502\n\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\n",
      "stderr": "/usr/lib/python3.10/runpy.py:110: UserWarning: MarketPipe is in alpha development. Expect breaking changes and potential stability issues. Not recommended for production use without thorough testing.\n  __import__(pkg_name)\n",
      "error_message": "",
      "expected_behavior": "should show prune database options",
      "actual_behavior": "Command completed successfully",
      "severity": "low"
    }
  ]
}